jQuery(function(a){function b(){e&&sessionStorage.setItem("wc_cart_created",(new Date).getTime())}function c(a){e&&(localStorage.setItem(f,a),sessionStorage.setItem(f,a))}function d(){a.ajax(h)}if("undefined"==typeof wc_cart_fragments_params)return!1;var e,f=wc_cart_fragments_params.ajax_url.toString()+"-wc_cart_hash";try{e="sessionStorage"in window&&null!==window.sessionStorage,window.sessionStorage.setItem("wc","test"),window.sessionStorage.removeItem("wc"),window.localStorage.setItem("wc","test"),window.localStorage.removeItem("wc")}catch(g){e=!1}var h={url:wc_cart_fragments_params.wc_ajax_url.toString().replace("%%endpoint%%","get_refreshed_fragments"),type:"POST",success:function(d){d&&d.fragments&&(a.each(d.fragments,function(b,c){a(b).replaceWith(c)}),e&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(d.fragments)),c(d.cart_hash),d.cart_hash&&b()),a(document.body).trigger("wc_fragments_refreshed"))}};if(e){var i=null,j=864e5;a(document.body).bind("wc_fragment_refresh updated_wc_div",function(){d()}),a(document.body).bind("added_to_cart",function(a,d,e){var g=sessionStorage.getItem(f);null!==g&&void 0!==g&&""!==g||b(),sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(d)),c(e)}),a(document.body).bind("wc_fragments_refreshed",function(){clearTimeout(i),i=setTimeout(d,j)}),a(window).on("storage onstorage",function(a){f===a.originalEvent.key&&localStorage.getItem(f)!==sessionStorage.getItem(f)&&d()});try{var k=a.parseJSON(sessionStorage.getItem(wc_cart_fragments_params.fragment_name)),l=sessionStorage.getItem(f),m=a.cookie("woocommerce_cart_hash"),n=sessionStorage.getItem("wc_cart_created");if(null!==l&&void 0!==l&&""!==l||(l=""),null!==m&&void 0!==m&&""!==m||(m=""),l&&(null===n||void 0===n||""===n))throw"No cart_created";if(n){var o=1*n+j,p=(new Date).getTime();if(o<p)throw"Fragment expired";i=setTimeout(d,o-p)}if(!k||!k["div.widget_shopping_cart_content"]||l!==m)throw"No fragment";a.each(k,function(b,c){a(b).replaceWith(c)}),a(document.body).trigger("wc_fragments_loaded")}catch(g){d()}}else d();a.cookie("woocommerce_items_in_cart")>0?a(".hide_cart_widget_if_empty").closest(".widget_shopping_cart").show():a(".hide_cart_widget_if_empty").closest(".widget_shopping_cart").hide(),a(document.body).bind("adding_to_cart",function(){a(".hide_cart_widget_if_empty").closest(".widget_shopping_cart").show()})});
;(function(a){if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],a)}else{a(jQuery)}}(function(e){var o="left",n="right",d="up",v="down",c="in",w="out",l="none",r="auto",k="swipe",s="pinch",x="tap",i="doubletap",b="longtap",A="horizontal",t="vertical",h="all",q=10,f="start",j="move",g="end",p="cancel",a="ontouchstart" in window,y="TouchSwipe";var m={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,triggerOnTouchEnd:true,triggerOnTouchLeave:false,allowPageScroll:"auto",fallbackToMouseEvents:true,excludedElements:"label, button, input, select, textarea, a, .noSwipe"};e.fn.swipe=function(D){var C=e(this),B=C.data(y);if(B&&typeof D==="string"){if(B[D]){return B[D].apply(this,Array.prototype.slice.call(arguments,1))}else{e.error("Method "+D+" does not exist on jQuery.swipe")}}else{if(!B&&(typeof D==="object"||!D)){return u.apply(this,arguments)}}return C};e.fn.swipe.defaults=m;e.fn.swipe.phases={PHASE_START:f,PHASE_MOVE:j,PHASE_END:g,PHASE_CANCEL:p};e.fn.swipe.directions={LEFT:o,RIGHT:n,UP:d,DOWN:v,IN:c,OUT:w};e.fn.swipe.pageScroll={NONE:l,HORIZONTAL:A,VERTICAL:t,AUTO:r};e.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:h};function u(B){if(B&&(B.allowPageScroll===undefined&&(B.swipe!==undefined||B.swipeStatus!==undefined))){B.allowPageScroll=l}if(B.click!==undefined&&B.tap===undefined){B.tap=B.click}if(!B){B={}}B=e.extend({},e.fn.swipe.defaults,B);return this.each(function(){var D=e(this);var C=D.data(y);if(!C){C=new z(this,B);D.data(y,C)}})}function z(a0,aq){var av=(a||!aq.fallbackToMouseEvents),G=av?"touchstart":"mousedown",au=av?"touchmove":"mousemove",R=av?"touchend":"mouseup",P=av?null:"mouseleave",az="touchcancel";var ac=0,aL=null,Y=0,aX=0,aV=0,D=1,am=0,aF=0,J=null;var aN=e(a0);var W="start";var T=0;var aM=null;var Q=0,aY=0,a1=0,aa=0,K=0;var aS=null;try{aN.bind(G,aJ);aN.bind(az,a5)}catch(ag){e.error("events not supported "+G+","+az+" on jQuery.swipe")}this.enable=function(){aN.bind(G,aJ);aN.bind(az,a5);return aN};this.disable=function(){aG();return aN};this.destroy=function(){aG();aN.data(y,null);return aN};this.option=function(a8,a7){if(aq[a8]!==undefined){if(a7===undefined){return aq[a8]}else{aq[a8]=a7}}else{e.error("Option "+a8+" does not exist on jQuery.swipe.options")}return null};function aJ(a9){if(ax()){return}if(e(a9.target).closest(aq.excludedElements,aN).length>0){return}var ba=a9.originalEvent?a9.originalEvent:a9;var a8,a7=a?ba.touches[0]:ba;W=f;if(a){T=ba.touches.length}else{a9.preventDefault()}ac=0;aL=null;aF=null;Y=0;aX=0;aV=0;D=1;am=0;aM=af();J=X();O();if(!a||(T===aq.fingers||aq.fingers===h)||aT()){ae(0,a7);Q=ao();if(T==2){ae(1,ba.touches[1]);aX=aV=ap(aM[0].start,aM[1].start)}if(aq.swipeStatus||aq.pinchStatus){a8=L(ba,W)}}else{a8=false}if(a8===false){W=p;L(ba,W);return a8}else{ak(true)}return null}function aZ(ba){var bd=ba.originalEvent?ba.originalEvent:ba;if(W===g||W===p||ai()){return}var a9,a8=a?bd.touches[0]:bd;var bb=aD(a8);aY=ao();if(a){T=bd.touches.length}W=j;if(T==2){if(aX==0){ae(1,bd.touches[1]);aX=aV=ap(aM[0].start,aM[1].start)}else{aD(bd.touches[1]);aV=ap(aM[0].end,aM[1].end);aF=an(aM[0].end,aM[1].end)}D=a3(aX,aV);am=Math.abs(aX-aV)}if((T===aq.fingers||aq.fingers===h)||!a||aT()){aL=aH(bb.start,bb.end);ah(ba,aL);ac=aO(bb.start,bb.end);Y=aI();aE(aL,ac);if(aq.swipeStatus||aq.pinchStatus){a9=L(bd,W)}if(!aq.triggerOnTouchEnd||aq.triggerOnTouchLeave){var a7=true;if(aq.triggerOnTouchLeave){var bc=aU(this);a7=B(bb.end,bc)}if(!aq.triggerOnTouchEnd&&a7){W=ay(j)}else{if(aq.triggerOnTouchLeave&&!a7){W=ay(g)}}if(W==p||W==g){L(bd,W)}}}else{W=p;L(bd,W)}if(a9===false){W=p;L(bd,W)}}function I(a7){var a8=a7.originalEvent;if(a){if(a8.touches.length>0){C();return true}}if(ai()){T=aa}a7.preventDefault();aY=ao();Y=aI();if(a6()){W=p;L(a8,W)}else{if(aq.triggerOnTouchEnd||(aq.triggerOnTouchEnd==false&&W===j)){W=g;L(a8,W)}else{if(!aq.triggerOnTouchEnd&&a2()){W=g;aB(a8,W,x)}else{if(W===j){W=p;L(a8,W)}}}}ak(false);return null}function a5(){T=0;aY=0;Q=0;aX=0;aV=0;D=1;O();ak(false)}function H(a7){var a8=a7.originalEvent;if(aq.triggerOnTouchLeave){W=ay(g);L(a8,W)}}function aG(){aN.unbind(G,aJ);aN.unbind(az,a5);aN.unbind(au,aZ);aN.unbind(R,I);if(P){aN.unbind(P,H)}ak(false)}function ay(bb){var ba=bb;var a9=aw();var a8=aj();var a7=a6();if(!a9||a7){ba=p}else{if(a8&&bb==j&&(!aq.triggerOnTouchEnd||aq.triggerOnTouchLeave)){ba=g}else{if(!a8&&bb==g&&aq.triggerOnTouchLeave){ba=p}}}return ba}function L(a9,a7){var a8=undefined;if(F()||S()){a8=aB(a9,a7,k)}else{if((M()||aT())&&a8!==false){a8=aB(a9,a7,s)}}if(aC()&&a8!==false){a8=aB(a9,a7,i)}else{if(al()&&a8!==false){a8=aB(a9,a7,b)}else{if(ad()&&a8!==false){a8=aB(a9,a7,x)}}}if(a7===p){a5(a9)}if(a7===g){if(a){if(a9.touches.length==0){a5(a9)}}else{a5(a9)}}return a8}function aB(ba,a7,a9){var a8=undefined;if(a9==k){aN.trigger("swipeStatus",[a7,aL||null,ac||0,Y||0,T]);if(aq.swipeStatus){a8=aq.swipeStatus.call(aN,ba,a7,aL||null,ac||0,Y||0,T);if(a8===false){return false}}if(a7==g&&aR()){aN.trigger("swipe",[aL,ac,Y,T]);if(aq.swipe){a8=aq.swipe.call(aN,ba,aL,ac,Y,T);if(a8===false){return false}}switch(aL){case o:aN.trigger("swipeLeft",[aL,ac,Y,T]);if(aq.swipeLeft){a8=aq.swipeLeft.call(aN,ba,aL,ac,Y,T)}break;case n:aN.trigger("swipeRight",[aL,ac,Y,T]);if(aq.swipeRight){a8=aq.swipeRight.call(aN,ba,aL,ac,Y,T)}break;case d:aN.trigger("swipeUp",[aL,ac,Y,T]);if(aq.swipeUp){a8=aq.swipeUp.call(aN,ba,aL,ac,Y,T)}break;case v:aN.trigger("swipeDown",[aL,ac,Y,T]);if(aq.swipeDown){a8=aq.swipeDown.call(aN,ba,aL,ac,Y,T)}break}}}if(a9==s){aN.trigger("pinchStatus",[a7,aF||null,am||0,Y||0,T,D]);if(aq.pinchStatus){a8=aq.pinchStatus.call(aN,ba,a7,aF||null,am||0,Y||0,T,D);if(a8===false){return false}}if(a7==g&&a4()){switch(aF){case c:aN.trigger("pinchIn",[aF||null,am||0,Y||0,T,D]);if(aq.pinchIn){a8=aq.pinchIn.call(aN,ba,aF||null,am||0,Y||0,T,D)}break;case w:aN.trigger("pinchOut",[aF||null,am||0,Y||0,T,D]);if(aq.pinchOut){a8=aq.pinchOut.call(aN,ba,aF||null,am||0,Y||0,T,D)}break}}}if(a9==x){if(a7===p||a7===g){clearTimeout(aS);if(V()&&!E()){K=ao();aS=setTimeout(e.proxy(function(){K=null;aN.trigger("tap",[ba.target]);if(aq.tap){a8=aq.tap.call(aN,ba,ba.target)}},this),aq.doubleTapThreshold)}else{K=null;aN.trigger("tap",[ba.target]);if(aq.tap){a8=aq.tap.call(aN,ba,ba.target)}}}}else{if(a9==i){if(a7===p||a7===g){clearTimeout(aS);K=null;aN.trigger("doubletap",[ba.target]);if(aq.doubleTap){a8=aq.doubleTap.call(aN,ba,ba.target)}}}else{if(a9==b){if(a7===p||a7===g){clearTimeout(aS);K=null;aN.trigger("longtap",[ba.target]);if(aq.longTap){a8=aq.longTap.call(aN,ba,ba.target)}}}}}return a8}function aj(){var a7=true;if(aq.threshold!==null){a7=ac>=aq.threshold}return a7}function a6(){var a7=false;if(aq.cancelThreshold!==null&&aL!==null){a7=(aP(aL)-ac)>=aq.cancelThreshold}return a7}function ab(){if(aq.pinchThreshold!==null){return am>=aq.pinchThreshold}return true}function aw(){var a7;if(aq.maxTimeThreshold){if(Y>=aq.maxTimeThreshold){a7=false}else{a7=true}}else{a7=true}return a7}function ah(a7,a8){if(aq.allowPageScroll===l||aT()){a7.preventDefault()}else{var a9=aq.allowPageScroll===r;switch(a8){case o:if((aq.swipeLeft&&a9)||(!a9&&aq.allowPageScroll!=A)){a7.preventDefault()}break;case n:if((aq.swipeRight&&a9)||(!a9&&aq.allowPageScroll!=A)){a7.preventDefault()}break;case d:if((aq.swipeUp&&a9)||(!a9&&aq.allowPageScroll!=t)){a7.preventDefault()}break;case v:if((aq.swipeDown&&a9)||(!a9&&aq.allowPageScroll!=t)){a7.preventDefault()}break}}}function a4(){var a8=aK();var a7=U();var a9=ab();return a8&&a7&&a9}function aT(){return !!(aq.pinchStatus||aq.pinchIn||aq.pinchOut)}function M(){return !!(a4()&&aT())}function aR(){var ba=aw();var bc=aj();var a9=aK();var a7=U();var a8=a6();var bb=!a8&&a7&&a9&&bc&&ba;return bb}function S(){return !!(aq.swipe||aq.swipeStatus||aq.swipeLeft||aq.swipeRight||aq.swipeUp||aq.swipeDown)}function F(){return !!(aR()&&S())}function aK(){return((T===aq.fingers||aq.fingers===h)||!a)}function U(){return aM[0].end.x!==0}function a2(){return !!(aq.tap)}function V(){return !!(aq.doubleTap)}function aQ(){return !!(aq.longTap)}function N(){if(K==null){return false}var a7=ao();return(V()&&((a7-K)<=aq.doubleTapThreshold))}function E(){return N()}function at(){return((T===1||!a)&&(isNaN(ac)||ac===0))}function aW(){return((Y>aq.longTapThreshold)&&(ac<q))}function ad(){return !!(at()&&a2())}function aC(){return !!(N()&&V())}function al(){return !!(aW()&&aQ())}function C(){a1=ao();aa=event.touches.length+1}function O(){a1=0;aa=0}function ai(){var a7=false;if(a1){var a8=ao()-a1;if(a8<=aq.fingerReleaseThreshold){a7=true}}return a7}function ax(){return !!(aN.data(y+"_intouch")===true)}function ak(a7){if(a7===true){aN.bind(au,aZ);aN.bind(R,I);if(P){aN.bind(P,H)}}else{aN.unbind(au,aZ,false);aN.unbind(R,I,false);if(P){aN.unbind(P,H,false)}}aN.data(y+"_intouch",a7===true)}function ae(a8,a7){var a9=a7.identifier!==undefined?a7.identifier:0;aM[a8].identifier=a9;aM[a8].start.x=aM[a8].end.x=a7.pageX||a7.clientX;aM[a8].start.y=aM[a8].end.y=a7.pageY||a7.clientY;return aM[a8]}function aD(a7){var a9=a7.identifier!==undefined?a7.identifier:0;var a8=Z(a9);a8.end.x=a7.pageX||a7.clientX;a8.end.y=a7.pageY||a7.clientY;return a8}function Z(a8){for(var a7=0;a7<aM.length;a7++){if(aM[a7].identifier==a8){return aM[a7]}}}function af(){var a7=[];for(var a8=0;a8<=5;a8++){a7.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0})}return a7}function aE(a7,a8){a8=Math.max(a8,aP(a7));J[a7].distance=a8}function aP(a7){if(J[a7]){return J[a7].distance}return undefined}function X(){var a7={};a7[o]=ar(o);a7[n]=ar(n);a7[d]=ar(d);a7[v]=ar(v);return a7}function ar(a7){return{direction:a7,distance:0}}function aI(){return aY-Q}function ap(ba,a9){var a8=Math.abs(ba.x-a9.x);var a7=Math.abs(ba.y-a9.y);return Math.round(Math.sqrt(a8*a8+a7*a7))}function a3(a7,a8){var a9=(a8/a7)*1;return a9.toFixed(2)}function an(){if(D<1){return w}else{return c}}function aO(a8,a7){return Math.round(Math.sqrt(Math.pow(a7.x-a8.x,2)+Math.pow(a7.y-a8.y,2)))}function aA(ba,a8){var a7=ba.x-a8.x;var bc=a8.y-ba.y;var a9=Math.atan2(bc,a7);var bb=Math.round(a9*180/Math.PI);if(bb<0){bb=360-Math.abs(bb)}return bb}function aH(a8,a7){var a9=aA(a8,a7);if((a9<=45)&&(a9>=0)){return o}else{if((a9<=360)&&(a9>=315)){return o}else{if((a9>=135)&&(a9<=225)){return n}else{if((a9>45)&&(a9<135)){return v}else{return d}}}}}function ao(){var a7=new Date();return a7.getTime()}function aU(a7){a7=e(a7);var a9=a7.offset();var a8={left:a9.left,right:a9.left+a7.outerWidth(),top:a9.top,bottom:a9.top+a7.outerHeight()};return a8}function B(a7,a8){return(a7.x>a8.left&&a7.x<a8.right&&a7.y>a8.top&&a7.y<a8.bottom)}}}));
;var chat_localized;if(chat_localized){var instanse=false;var logging_out=false;var mes;var file;var postid;var currentContent=[];var lastCheck=[];var last_mid=[];var chat_refresh_timer=[];var mids=[];var chat;var pingSound;var lastUpdate=[];var name=chat_localized["name"];var vip=chat_localized["vip"];var sounds=chat_localized["sounds"];var post_id=chat_localized["post_id"];function Chat(){this.update=updateChat;this.send=sendChat;this.setup=setupChat;this.clear=clearChat;this.archive=archiveChat;}
function updateChat(sounds){if(!instanse){jQuery('.chat-post-id').each(function(){var instanse=true;var pid=jQuery(this).val();if(!lastCheck[pid]){lastCheck[pid]=0;last_mid[pid]=0;lastUpdate[pid]=new Date().getTime();}
if(!(pid==1&&jQuery('#chat-block-site').hasClass('closed'))){jQuery.ajax({type:"POST",url:chat_localized["url"],data:{'function':'update','cid':pid,'file':file,'action':'chatProcess','avatar':chat_localized["avatar_"+pid],'emoticons':chat_localized["avatar_"+pid],'date_color':chat_localized["date_color_"+pid],'name_color':chat_localized["name_color_"+pid],'moderator_name_color':chat_localized["moderator_name_color_"+pid],'text_color':chat_localized["text_color_"+pid],'date_show':chat_localized["date_show_"+pid],'time_show':chat_localized["time_show_"+pid],'since':lastCheck[pid],'since_id':last_mid[pid],'moderator_roles':chat_localized["moderator_roles_"+pid]},dataType:"json",success:function(data){if(data&&data.text){var updateContent='';for(i in data.text){updateContent=updateContent+"<p>"+data.text[i]+"</p>";last_mid[pid]=i;}
lastCheck[pid]=Math.max(data.time,lastCheck[pid]);if(currentContent[pid]!==updateContent){if(updateContent!==''){jQuery('#chat-area-'+pid).append(jQuery(updateContent.replace(currentContent[pid],'')));currentContent[pid]=updateContent;var container=jQuery('#chat-area-'+pid);var row=jQuery('div.row',container).last();if(row.length){var r_position=row.position();var c_scrollTop=container.scrollTop()+r_position.top;jQuery('#chat-area-'+pid).animate({scrollTop:c_scrollTop},1000);}
if(sounds!=='disabled'&&chat_localized['sound_'+pid]!=='disabled'&&pingSound){pingSound.play('notify');}}}}
instanse=false;lastUpdate[pid]=new Date().getTime();}});if(new Date().getTime()>lastUpdate[pid]+(chat_localized["interval"]*1000)*60){jQuery('#chat-send-'+pid).attr('disabled',true);}else{jQuery('#chat-send-'+pid).attr('disabled',false);}}});}else{}}
function sendChat(pid,message,name,vip,sounds,type){message=jQuery.trim(message);name=base64_encode(jQuery.trim(name));jQuery.ajax({type:"POST",url:chat_localized["url"],data:{'function':'send','cid':pid,'message':message,'name':name,'type':type,'vip':vip,'file':file,'action':'chatProcess','moderator_roles':chat_localized["moderator_roles_"+pid]},dataType:"json",success:function(data){updateChat(sounds);}});}
function clearChat(pid){jQuery.ajax({type:"POST",url:chat_localized["url"],data:{'cid':pid,'vip':vip,'file':file,'action':'chatClear','since':lastCheck[pid]},dataType:"json",success:function(data){window.location.reload();}});}
function archiveChat(pid){jQuery.ajax({type:"POST",url:chat_localized["url"],data:{'cid':pid,'vip':vip,'file':file,'action':'chatArchive','since':lastCheck[pid]},dataType:"json",success:function(data){window.location.reload();}});}
function setupChat(pid,sounds){postid=pid;chat_refresh_timer[pid]=setInterval("updateChat(sounds)",chat_localized["interval"]*1000);updateChat(sounds);}
name=name.replace(/(<([^>]+)>)/ig,"");chat=new Chat();chat.setup(post_id,sounds);(function($){$(document).ready(function(){soundManager.url=chat_localized.plugin_url+'swf/';soundManager.onload=function(){pingSound=soundManager.createSound({id:'ping',url:chat_localized.plugin_url+'/audio/ping.mp3',volume:100});};if(!$('#chat-block-site').hasClass('closed')&&$('#chat-box-1').height()>$(window).height()){$('#chat-block-inner').height($(window).height()-50);if($('#chat-block-site').hasClass('free-width')){width=Math.max(425,$('#chat-box-1').width());}else{width=$('#chat-box-1').width();}
$('#chat-block-site').width(width+15);}else{if($('#chat-block-inner .chat-login-wrap').hasClass('chat-login-wrap')){$('#chat-block-inner').height($('#chat-box-1').height()+50);}else{$('#chat-block-inner').height($('#chat-box-1').height());}}
$(window).resize(function(){if(!$('#chat-block-site').hasClass('closed')){if($('#chat-box-1').height()>$(window).height()){$('#chat-block-inner').height($(window).height()-50);if($('#chat-block-site').hasClass('free-width')){width=Math.max(425,$('#chat-box-1').width());}else{width=$('#chat-box-1').width();}
$('#chat-block-site').width(width+15);}
if($(window).height()>$('#chat-box-1').height()){$('#chat-block-inner').height($('#chat-box-1').height()+5);if($('#chat-block-site').hasClass('free-width')){width=Math.max(425,$('#chat-box-1').width());}else{width=$('#chat-box-1').width();}
$('#chat-block-site').width(width);}}
$('.chat-send').each(function(){$(this).width($(this).closest('.chat-send-wrap').width()-12);})});$(".chat-send").keydown(function(event){var key=event.which;if(key>=33){var maxLength=2000;var length=this.value.length;if(length>=maxLength){event.preventDefault();}}});$('.chat-send').keyup(function(e){if(e.keyCode==13){var text=$(this).val();var maxLength=2000;var length=text.length;if(length<=maxLength+1){cid=$(this).closest('form').find('.chat-post-id').val();chat.send(cid,text,chat_localized['name_'+cid],vip,chat_localized['sound_'+cid],chat_localized['type_'+cid]);$(this).val("");}else{$(this).val(text.substring(0,maxLength));}}});$('.chat-clear').click(function(e){chat.clear($(this).closest('form').find('.chat-post-id').val());$(this).attr("disabled","disabled");$(this).val(chat_localized.please_wait);});$('.chat-archive').click(function(e){chat.archive($(this).closest('form').find('.chat-post-id').val());$(this).attr("disabled","disabled");$(this).val(chat_localized.please_wait);});$('.chat-clear').attr("disabled",false);$('.chat-archive').attr("disabled",false);$('div.chat-emoticons-list span.chat-emoticon').click(function(){cid=$(this).closest('div').attr('id').replace(/chat\-emoticons\-list\-/,'');$('#chat-send-'+cid).val($('#chat-send-'+cid).val()+' '+$(this).find('img').attr('alt')).focus();});$('#chat-block-header').click(function(){if($('#chat-toggle-button').attr('alt')=='-'){$('#chat-block-site').addClass('closed');$('#chat-toggle-button').attr('alt','+');$('#chat-toggle-button').attr('src',chat_localized.maximize_button);$('#chat-toggle-button').attr('title',chat_localized.maximize);$.cookie('chat_site_wide_state_104','closed',{expires:7,path:'/'});}else{$('#chat-block-site').removeClass('closed');$('#chat-toggle-button').attr('alt','-');$('#chat-toggle-button').attr('src',chat_localized.minimize_button);$('#chat-toggle-button').attr('title',chat_localized.minimize);$.cookie('chat_site_wide_state_104','open',{expires:7,path:'/'});}
$(window).resize();});$('form.chat-login').submit(function(){if($.cookie('chat_stateless_user_type_104')&&$.cookie('chat_stateless_user_type_104').match(',')){login_options=$.cookie('chat_stateless_user_type_104').split(',');if(!$.cookie('chat_stateless_user_type_104').match('public_user')){login_options.push('public_user');}}else{login_options=[$.cookie('chat_stateless_user_type_104'),'public_user'];}
$.cookie('chat_stateless_user_type_104',login_options.join(','),{expires:7,path:'/'});$.cookie('chat_stateless_user_name_public_user',$(this).find('input.chat-login-name').val(),{expires:7,path:'/'});$.cookie('chat_stateless_user_image_public_user',$(this).find('input.chat-login-email').val(),{expires:7,path:'/'});window.location.reload();return false;});if($.cookie('chat_site_wide_state_104')=='open'){$('#chat-block-site').removeClass('closed');$('#chat-toggle-button').attr('alt','-');$('#chat-toggle-button').attr('src',chat_localized.minimize_button);$('#chat-toggle-button').attr('title',chat_localized.minimize);$.cookie('chat_site_wide_state_104','open',{expires:7,path:'/'});}
$(window).resize();});})(jQuery);(function($){if(chat_localized['twitter_active']){twttr.anywhere(function(T){if(T.isConnected()){$(".chat-twitter-signin-btn").append('<button class="chat-twitter-signout-btn" type="button">'+chat_localized.twitter_text_sign_out+'</button>');$(".chat-twitter-signout-btn").bind("click",function(){twttr.anywhere.signOut();});if($.cookie('chat_stateless_user_type_104')&&$.cookie('chat_stateless_user_type_104').match(',')){login_options=$.cookie('chat_stateless_user_type_104').split(',')
if(!$.cookie('chat_stateless_user_type_104').match('twitter')){login_options.push('twitter');}}else{login_options=[$.cookie('chat_stateless_user_type_104'),'twitter'];}
$.cookie('chat_stateless_user_type_104',login_options.join(','),{expires:7,path:'/'});$.cookie('chat_stateless_user_name_twitter',T.currentUser.data('name'),{expires:7,path:'/'});$.cookie('chat_stateless_user_image_twitter',T.currentUser.data('profile_image_url'),{expires:7,path:'/'});}else{$(".chat-twitter-signin-btn").each(function(){T("#"+$(this).attr('id')).connectButton({size:"large"});});}
T.bind("authComplete",function(e,user){if($.cookie('chat_stateless_user_type_104')&&$.cookie('chat_stateless_user_type_104').match(',')){login_options=$.cookie('chat_stateless_user_type_104').split(',');if(!$.cookie('chat_stateless_user_type_104').match('twitter')){login_options.push('twitter');}}else{login_options=[$.cookie('chat_stateless_user_type_104'),'twitter'];}
$.cookie('chat_stateless_user_type_104',login_options.join(','),{expires:7,path:'/'});$.cookie('chat_stateless_user_name_twitter',T.currentUser.data('name'),{expires:7,path:'/'});$.cookie('chat_stateless_user_image_twitter',T.currentUser.data('profile_image_url'),{expires:7,path:'/'});window.location.reload();});T.bind("signOut",function(e){$.cookie('chat_stateless_user_type_104',$.cookie('chat_stateless_user_type_104').replace(',twitter',''),{path:'/'});$.cookie('chat_stateless_user_name_twitter',null,{path:'/'});$.cookie('chat_stateless_user_image_twitter',null,{path:'/'});if(!logging_out){window.location.reload();}});});}
if(chat_localized['facebook_active']){$(".chat-facebook-signin-btn").html('<fb:login-button></fb:login-button>');$("body").append('<div id="fb-root"></div>');FB.init({appId:chat_localized.facebook_app_id,status:true,cookie:true,xfbml:true});FB.Event.subscribe('auth.sessionChange',function(response){if(!response.session){$.cookie('chat_stateless_user_type_104',$.cookie('chat_stateless_user_type_104').replace(',facebook',''),{path:'/'});$.cookie('chat_stateless_user_name_facebook',null,{path:'/'});$.cookie('chat_stateless_user_image_facebook',null,{path:'/'});}
if(!logging_out){window.location.reload();}});FB.getLoginStatus(function(response){if(response.session){$(".chat-facebook-signin-btn").html('<button class="chat-facebook-signout-btn" type="button">'+chat_localized.facebook_text_sign_out+'</button>');$(".chat-facebook-signout-btn").bind("click",function(){FB.logout();});}});}
$('input.chat-logout-submit').click(function(){try{if($.cookie('chat_stateless_user_type_104')&&$.cookie('chat_stateless_user_type_104').match('public_user')){$.cookie('chat_stateless_user_type_104',$.cookie('chat_stateless_user_type_104').replace(',public_user',''),{path:'/'});$.cookie('chat_stateless_user_name_public_user',null,{path:'/'});$.cookie('chat_stateless_user_image_public_user',null,{path:'/'});window.location.reload();}
if($.cookie('chat_stateless_user_type_104')&&$.cookie('chat_stateless_user_type_104').match('facebook')){if(chat_localized['facebook_active']){FB.logout();}}
if($.cookie('chat_stateless_user_type_104')&&$.cookie('chat_stateless_user_type_104').match('twitter')){if(chat_localized['twitter_active']){twttr.anywhere(function(T){twttr.anywhere.signOut();});}}}catch(e){$.cookie('chat_stateless_user_type_104','',{path:'/'});$.cookie('chat_stateless_user_name_public_user',null,{path:'/'});$.cookie('chat_stateless_user_image_public_user',null,{path:'/'});$.cookie('chat_stateless_user_name_twitter',null,{path:'/'});$.cookie('chat_stateless_user_image_twitter',null,{path:'/'});$.cookie('chat_stateless_user_name_facebook',null,{path:'/'});$.cookie('chat_stateless_user_image_facebook',null,{path:'/'});window.location.reload();}});})(jQuery);}
function base64_decode(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');dec=this.utf8_decode(dec);return dec;}
function base64_encode(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data;}
data=this.utf8_encode(data+'');do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);}while(i<data.length);enc=tmp_arr.join('');switch(data.length%3){case 1:enc=enc.slice(0,-2)+'==';break;case 2:enc=enc.slice(0,-1)+'=';break;}
return enc;}
function utf8_decode(str_data){var tmp_arr=[],i=0,ac=0,c1=0,c2=0,c3=0;str_data+='';while(i<str_data.length){c1=str_data.charCodeAt(i);if(c1<128){tmp_arr[ac++]=String.fromCharCode(c1);i++;}else if((c1>191)&&(c1<224)){c2=str_data.charCodeAt(i+1);tmp_arr[ac++]=String.fromCharCode(((c1&31)<<6)|(c2&63));i+=2;}else{c2=str_data.charCodeAt(i+1);c3=str_data.charCodeAt(i+2);tmp_arr[ac++]=String.fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return tmp_arr.join('');}
function utf8_encode(argString){var string=(argString+'');var utftext="";var start,end;var stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++;}else if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128);}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128);}
if(enc!==null){if(end>start){utftext+=string.substring(start,end);}
utftext+=enc;start=end=n+1;}}
if(end>start){utftext+=string.substring(start,string.length);}
return utftext;}
;!function(a,b){"use strict";function c(){if(!e){e=!0;var a,c,d,f,g=-1!==navigator.appVersion.indexOf("MSIE 10"),h=!!navigator.userAgent.match(/Trident.*rv:11\./),i=b.querySelectorAll("iframe.wp-embedded-content");for(c=0;c<i.length;c++)if(d=i[c],!d.getAttribute("data-secret")){if(f=Math.random().toString(36).substr(2,10),d.src+="#?secret="+f,d.setAttribute("data-secret",f),g||h)a=d.cloneNode(!0),a.removeAttribute("security"),d.parentNode.replaceChild(a,d)}else;}}var d=!1,e=!1;if(b.querySelector)if(a.addEventListener)d=!0;if(a.wp=a.wp||{},!a.wp.receiveEmbedMessage)if(a.wp.receiveEmbedMessage=function(c){var d=c.data;if(d.secret||d.message||d.value)if(!/[^a-zA-Z0-9]/.test(d.secret)){var e,f,g,h,i,j=b.querySelectorAll('iframe[data-secret="'+d.secret+'"]'),k=b.querySelectorAll('blockquote[data-secret="'+d.secret+'"]');for(e=0;e<k.length;e++)k[e].style.display="none";for(e=0;e<j.length;e++)if(f=j[e],c.source===f.contentWindow){if(f.removeAttribute("style"),"height"===d.message){if(g=parseInt(d.value,10),g>1e3)g=1e3;else if(~~g<200)g=200;f.height=g}if("link"===d.message)if(h=b.createElement("a"),i=b.createElement("a"),h.href=f.getAttribute("src"),i.href=d.value,i.host===h.host)if(b.activeElement===f)a.top.location.href=d.value}else;}},d)a.addEventListener("message",a.wp.receiveEmbedMessage,!1),b.addEventListener("DOMContentLoaded",c,!1),a.addEventListener("load",c,!1)}(window,document);
;"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return a<10?"0"+a:a}function this_value(){return this.valueOf()}function quote(a){return rx_escapable.lastIndex=0,rx_escapable.test(a)?'"'+a.replace(rx_escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();
;window.wp=window.wp||{},function(a){var b="undefined"==typeof _wpUtilSettings?{}:_wpUtilSettings;wp.template=_.memoize(function(b){var c,d={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e){return(c=c||_.template(a("#tmpl-"+b).html(),d))(e)}}),wp.ajax={settings:b.ajax||{},post:function(a,b){return wp.ajax.send({data:_.isObject(a)?a:_.extend(b||{},{action:a})})},send:function(b,c){var d,e;return _.isObject(b)?c=b:(c=c||{},c.data=_.extend(c.data||{},{action:b})),c=_.defaults(c||{},{type:"POST",url:wp.ajax.settings.url,context:this}),e=a.Deferred(function(b){c.success&&b.done(c.success),c.error&&b.fail(c.error),delete c.success,delete c.error,b.jqXHR=a.ajax(c).done(function(a){"1"!==a&&1!==a||(a={success:!0}),_.isObject(a)&&!_.isUndefined(a.success)?b[a.success?"resolveWith":"rejectWith"](this,[a.data]):b.rejectWith(this,[a])}).fail(function(){b.rejectWith(this,arguments)})}),d=e.promise(),d.abort=function(){return e.jqXHR.abort(),this},d}}}(jQuery);
;window.wp=window.wp||{},function(a){wp.Backbone={},wp.Backbone.Subviews=function(a,b){this.view=a,this._views=_.isArray(b)?{"":b}:b||{}},wp.Backbone.Subviews.extend=Backbone.Model.extend,_.extend(wp.Backbone.Subviews.prototype,{all:function(){return _.flatten(_.values(this._views))},get:function(a){return a=a||"",this._views[a]},first:function(a){var b=this.get(a);return b&&b.length?b[0]:null},set:function(a,b,c){var d,e;return _.isString(a)||(c=b,b=a,a=""),c=c||{},b=_.isArray(b)?b:[b],d=this.get(a),e=b,d&&(c.add?_.isUndefined(c.at)?e=d.concat(b):(e=d,e.splice.apply(e,[c.at,0].concat(b))):(_.each(e,function(a){a.__detach=!0}),_.each(d,function(a){a.__detach?a.$el.detach():a.remove()}),_.each(e,function(a){delete a.__detach}))),this._views[a]=e,_.each(b,function(b){var c=b.Views||wp.Backbone.Subviews,d=b.views=b.views||new c(b);d.parent=this.view,d.selector=a},this),c.silent||this._attach(a,b,_.extend({ready:this._isReady()},c)),this},add:function(a,b,c){return _.isString(a)||(c=b,b=a,a=""),this.set(a,b,_.extend({add:!0},c))},unset:function(a,b,c){var d;return _.isString(a)||(c=b,b=a,a=""),b=b||[],(d=this.get(a))&&(b=_.isArray(b)?b:[b],this._views[a]=b.length?_.difference(d,b):[]),c&&c.silent||_.invoke(b,"remove"),this},detach:function(){return a(_.pluck(this.all(),"el")).detach(),this},render:function(){var a={ready:this._isReady()};return _.each(this._views,function(b,c){this._attach(c,b,a)},this),this.rendered=!0,this},remove:function(a){return a&&a.silent||(this.parent&&this.parent.views&&this.parent.views.unset(this.selector,this.view,{silent:!0}),delete this.parent,delete this.selector),_.invoke(this.all(),"remove"),this._views=[],this},replace:function(a,b){return a.html(b),this},insert:function(a,b,c){var d,e=c&&c.at;return _.isNumber(e)&&(d=a.children()).length>e?d.eq(e).before(b):a.append(b),this},ready:function(){this.view.trigger("ready"),_.chain(this.all()).map(function(a){return a.views}).flatten().where({attached:!0}).invoke("ready")},_attach:function(a,b,c){var d,e=a?this.view.$(a):this.view.$el;return e.length?(d=_.chain(b).pluck("views").flatten().value(),_.each(d,function(a){a.rendered||(a.view.render(),a.rendered=!0)},this),this[c.add?"insert":"replace"](e,_.pluck(b,"el"),c),_.each(d,function(a){a.attached=!0,c.ready&&a.ready()},this),this):this},_isReady:function(){for(var a=this.view.el;a;){if(a===document.body)return!0;a=a.parentNode}return!1}}),wp.Backbone.View=Backbone.View.extend({Subviews:wp.Backbone.Subviews,constructor:function(a){this.views=new this.Subviews(this,this.views),this.on("ready",this.ready,this),this.options=a||{},Backbone.View.apply(this,arguments)},remove:function(){var a=Backbone.View.prototype.remove.apply(this,arguments);return this.views&&this.views.remove(),a},render:function(){var a;return this.prepare&&(a=this.prepare()),this.views.detach(),this.template&&(a=a||{},this.trigger("prepare",a),this.$el.html(this.template(a))),this.views.render(),this},prepare:function(){return this.options},ready:function(){}})}(jQuery);
;/*! BuddyDrive - v2.0.0-beta1 - 2016-05-19 9:39:15 PM UTC - https://github.com/imath/buddydrive/ */
window.wp=window.wp||{},window.bp=window.bp||{},window.buddydrive=window.buddydrive||{},function(){return"undefined"==typeof BuddyDrive_App?!1:("undefined"==typeof BP_Uploader?_.extend(buddydrive,_.pick(wp,"Backbone","ajax","template")):_.extend(buddydrive,bp),buddydrive.Models=buddydrive.Models||{},buddydrive.Collections=buddydrive.Collections||{},buddydrive.Settings=BuddyDrive_App.settings||{},buddydrive.Strings=BuddyDrive_App.strings||{},buddydrive.Models.Query=Backbone.Model.extend({defaults:{paged:1,buddydrive_scope:"public",search:""}}),buddydrive.Models.Item=Backbone.Model.extend({defaults:{id:0,user_id:0,privacy:"public",link:"",type:"",date_created:0,date_edited:0},update:function(a,b){return b=b||{},b.context=this,b.data=a||{},b.data=_.extend(b.data,{action:"buddydrive_item_update",buddydrive_nonce:buddydrive.Settings.nonces.update_item}),buddydrive.ajax.send(b)}}),buddydrive.Models.bpObject=Backbone.Model.extend({defaults:{id:0,buddydrive_type:"group",name:"",link:"",avatar:""}}),buddydrive.Models.Stat=Backbone.Model.extend({defaults:{id:0,used:0},stat:function(a){return a=_.extend(a||{},{context:this,success:this.populate}),a.data=_.extend(a.data||{},{action:"buddydrive_get_stats",buddydrive_nonce:buddydrive.Settings.nonces.user_stats}),buddydrive.ajax.send(a)},populate:function(a){this.set(a)}}),buddydrive.Collections.Items=Backbone.Collection.extend({model:buddydrive.Models.Item,initialize:function(){this.options={paged:1,has_more_items:!1}},sync:function(a,b,c){return c=c||{},c.context=this,c.data=c.data||{},"read"===a?(c.data=_.extend(c.data,{action:"buddydrive_fetch_items",buddydrive_nonce:buddydrive.Settings.nonces.fetch_items}),buddydrive.ajax.send(c)):void 0},bulkEdit:function(a){return a=_.extend(a||{},{context:this,success:this.doBulk}),a.data=_.extend(a.data||{},{action:"buddydrive_bulk_edit_items",buddydrive_nonce:buddydrive.Settings.nonces.bulk_edit}),buddydrive.ajax.send(a)},doBulk:function(a){this.remove(a)},addFolder:function(a){return a=_.extend(a||{},{context:this,success:this.insertFolder}),a.data=_.extend(a.data||{},{action:"buddydrive_add_folder",buddydrive_nonce:buddydrive.Settings.nonces.new_folder}),buddydrive.ajax.send(a)},insertFolder:function(a){this.add(a)},parse:function(a){var b=a.items;return this.options=a.metas||this.options,_.isArray(b)||(b=[b]),_.each(b,function(a,c){_.isNull(a)||(b[c].date_created=new Date(a.date_created),b[c].date_edited=new Date(a.date_edited))}),b}}),void(buddydrive.Collections.bpObjects=Backbone.Collection.extend({model:buddydrive.Models.bpObject,sync:function(a,b,c){return"read"===a?(c=c||{},c.context=this,c.data=_.extend(c.data||{},{action:"buddydrive_get_bpobjects",buddydrive_nonce:buddydrive.Settings.nonces.fetch_objects}),buddydrive.ajax.send(c)):void 0},parse:function(a,b){return _.isArray(a)||(a=[a]),_.isUndefined(b.data.existing)||_.each(a,function(a){a.selected=!0}),a}})))}(buddydrive);
;/*! BuddyDrive - v2.0.0-beta1 - 2016-05-19 9:39:15 PM UTC - https://github.com/imath/buddydrive/ */
window.buddydrive=window.buddydrive||{},function(a,b){buddydrive.Views=buddydrive.Views||{},buddydrive.View=buddydrive.Backbone.View.extend({inject:function(a){this.render(),b(a).html(this.el),this.views.ready()},prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}},cleanViews:function(a){_.each(this.views._views[a],function(a){a.remove()})}}),buddydrive.Views.Feedback=buddydrive.View.extend({tagName:"div",className:"buddydrive-feedback",initialize:function(){this.value=this.options.value,this.type="info",_.isUndefined(this.options.type)||"info"===this.options.type||(this.type=this.options.type)},render:function(){return this.$el.html(b("<p></p>").html(this.value).addClass(this.type)),this}}),buddydrive.Views.Main=buddydrive.View.extend({tagName:"div",initialize:function(){this._views={},this.breadCrumbs=new Backbone.Collection,this.actions=new Backbone.Collection,this.warnings=new Backbone.Model,this.views.set([new buddydrive.View({tagName:"ul",className:"subsubsub"}),new buddydrive.Views.Toolbar({actions:this.actions}),new buddydrive.View({tagName:"div",id:"buddydrive-uploader",className:"buddydrive-hide"}),new buddydrive.View({tagName:"div",id:"buddydrive-actions-form",className:"buddydrive-hide"}),new buddydrive.View({tagName:"div",id:"buddydrive-status"}),new buddydrive.View({tagName:"ul",id:"buddydrive-browser"}),new buddydrive.View({tagName:"div",id:"buddydrive-pagination"})]),this.requestFiles(),this.collection.on("add",this.injectFile,this),this.collection.on("reset",this.cleanFiles,this),this.collection.on("remove",this.removeFileView,this),this.breadCrumbs.on("add",this.injectCrumb,this),this.breadCrumbs.on("reset",this.cleanCrumbs,this),this.actions.on("change:active",this.doToolbarActions,this),this.listenTo(buddydrive.App.Query,"change",this.requestFiles),_.isUndefined(buddydrive.Uploader)||(this.views.add("#buddydrive-uploader",new buddydrive.Views.UploadTool({actions:this.actions,warnings:this.warnings})),this.listenTo(buddydrive.Uploader.filesQueue,"add",this.insertFiles),this.listenTo(buddydrive.Uploader.filesError,"add",this.displayErrors),buddydrive.App.UploadParams=_.extend(_.pick(BP_Uploader.settings.defaults.multipart_params.bp_params,["item_id","privacy"]),{parent_folder_id:0})),this.listenTo(this.warnings,"change:message",this.displayErrors)},displayErrors:function(a){return a.get("message")?void this.views.add("#buddydrive-status",new buddydrive.Views.Feedback({type:"error",value:a.get("message")})):void this.cleanViews("#buddydrive-status")},insertFiles:function(a){this.collection.add(a)},removeFileView:function(a){_.each(this.views._views["#buddydrive-browser"],function(b){b.model.get("id")===a.get("id")&&b.remove()})},requestFiles:function(a){var b=!1;_.isUndefined(a)||(b=a.hasChanged("paged")&&1!==a.get("paged")),b||this.collection.reset(),this.views.set("#buddydrive-pagination",new buddydrive.Views.Loader),this.cleanViews("#buddydrive-status"),this.collection.fetch({data:buddydrive.App.Query.attributes,remove:!b,success:_.bind(this.filesFetched,this),error:_.bind(this.filesFetchError,this)})},filesFetched:function(a,b){this.breadCrumbs.reset();var c=[{id:"all",text:buddydrive.Strings.allCrumb,current:!0}],d=_.first(b.items)||{};(buddydrive.App.Query.get("buddydrive_parent")||buddydrive.App.Query.get("user_id"))&&(_.first(c).current=!1),buddydrive.App.Query.get("user_id")&&(_.isUndefined(d.user_avatar)||c.push({id:"user-"+buddydrive.App.Query.get("user_id"),text:d.user_avatar,current:!buddydrive.App.Query.get("buddydrive_parent")})),buddydrive.App.Query.get("buddydrive_parent")&&(_.isUndefined(d.post_parent_title)&&(d.post_parent_title=a.options.post_parent_title),c.push({id:"folder-"+buddydrive.App.Query.get("buddydrive_parent"),text:d.post_parent_title,current:!0})),this.breadCrumbs.add(c),a.options.has_more_items?this.views.set("#buddydrive-pagination",new buddydrive.Views.LoadMore({model:buddydrive.App.Query,text:buddydrive.Strings.loadMore})):this.cleanViews("#buddydrive-pagination"),_.isUndefined(a.options.no_items_found)||this.views.set("#buddydrive-status",new buddydrive.Views.Feedback({value:a.options.no_items_found}))},cleanFiles:function(){this.cleanViews("#buddydrive-browser")},cleanCrumbs:function(){this.cleanViews(".subsubsub")},filesFetchError:function(a,b){b.message&&(this.views.set("#buddydrive-status",new buddydrive.Views.Feedback({type:"error",value:b.message})),this.cleanViews("#buddydrive-pagination"))},injectFile:function(a){var b,c={};(a.get("uploading")||a.get("uploaded")||a.get("new_folder"))&&(c={at:0}),a.get("file_id")&&!_.isUndefined(buddydrive.Uploader)&&(b=_.indexOf(_.pluck(buddydrive.Uploader.filesQueue.models,"id"),a.get("file_id")),-1!==b&&(c={at:b})),this.collection.length>0&&a.get("new_folder")&&"title"===buddydrive.App.Query.get("orderby")&&(b=-1,_.each(this.collection.pluck("title").sort(function(a,b){return a.localeCompare(b)}),function(c,d){0>c.localeCompare(a.get("title"))&&(b=d+1)}),-1!==b&&(c={at:b})),this.views.add("#buddydrive-browser",new buddydrive.Views.File({model:a}),c)},injectCrumb:function(a){this.views.add(".subsubsub",new buddydrive.Views.BreadCrumb({model:a}))},doToolbarActions:function(a){return this.cleanViews("#buddydrive-status"),a.get("active")?(b(".buddydrive-share-dialog").addClass("buddydrive-hide"),void _.each(this.actions.models,function(c){a.get("id")===c.get("id")?"new_file"===a.get("id")?(b("#buddydrive-uploader").removeClass("buddydrive-hide"),b("#buddydrive-actions-form").addClass("buddydrive-hide"),b("#buddydrive-browser").removeClass("bulk-select"),buddydrive.App.Query.get("buddydrive_parent")&&!_.isUndefined(this.collection.options.post_parent_infos)&&this.views.set("#buddydrive-status",new buddydrive.Views.Feedback({value:this.collection.options.post_parent_infos})),b("#bp-upload-ui.drag-drop").find(".moxie-shim-html5").css({height:b("#bp-browse-button").outerHeight()+5+"px",width:b("#bp-browse-button").outerWidth()+5+"px",top:b("#bp-browse-button").position().top+"px",left:b("#bp-browse-button").position().left+"px"})):(b("#buddydrive-uploader").addClass("buddydrive-hide"),b("#buddydrive-actions-form").removeClass("buddydrive-hide"),b("#buddydrive-browser").removeClass("bulk-select"),"bulk"===a.get("id")?(b("#buddydrive-browser").addClass("bulk-select"),this.views.set("#buddydrive-actions-form",new buddydrive.Views.bulkEdit({collection:this.collection,bulkActions:buddydrive.Settings.bulk_actions,warnings:this.warnings}))):"new_folder"===a.get("id")?this.views.set("#buddydrive-actions-form",new buddydrive.Views.newFolder({model:c,warnings:this.warnings})):"stats"===a.get("id")&&this.views.set("#buddydrive-actions-form",new buddydrive.Views.userStats)):c.set("active",!1,{silent:!0})},this)):void("new_file"===a.get("id")?b("#buddydrive-uploader").addClass("buddydrive-hide"):(b("#buddydrive-actions-form").addClass("buddydrive-hide"),"bulk"===a.get("id")&&b("#buddydrive-browser").removeClass("bulk-select")))}}),buddydrive.Views.Loader=buddydrive.View.extend({tagName:"span",id:"buddydrive-loading"}),buddydrive.Views.File=buddydrive.View.extend({tagName:"li",template:buddydrive.template("buddydrive-file"),className:"buddydrive-item",events:{click:"bulkSelect","click .buddydrive-owner":"filterForUser","click .buddydrive-share":"showSharingBox","click .buddydrive-share-dialog-close":"hideSharingBox","click .buddydrive-share-url":"selectEmbed"},initialize:function(){this.listenTo(this.model,"change:percent",this.showProgress),this.listenTo(this.model,"change:id",this.deleteEntry),this.listenTo(this.model,"change:url",this.updateEntry),this.model.get("can_bulk_edit")||(this.el.className+=" not-bulk-editable")},deleteEntry:function(a){_.isUndefined(a.get("id"))&&(this.views.view.remove(),buddydrive.App.items.remove(a,{silent:!0}))},showProgress:function(a){_.isUndefined(a.get("percent"))||b("#"+a.get("id")+" .buddydrive-progress .buddydrive-bar").css("width",a.get("percent")+"%")},updateEntry:function(a){var b=_.extend({id:a.get("buddydrive_id"),file_id:a.get("id")},_.omit(a.attributes,["id","date","filename","uploading","buddydrive_id","url"]));buddydrive.App.items.remove(a),buddydrive.App.items.add(b)},bulkSelect:function(a){return b("#buddydrive-browser").hasClass("bulk-select")?(a.preventDefault(),void(this.model.get("bulk_selected")?(this.model.set("bulk_selected",!1),this.$el.removeClass("bulk-selected")):(this.model.set("bulk_selected",!0),this.$el.addClass("bulk-selected")))):a},filterForUser:function(a){return!b("body").hasClass("wp-admin")||b("#buddydrive-browser").hasClass("bulk-select")?a:(a.preventDefault(),buddydrive.App.Query.set({buddydrive_parent:0,paged:1},{silent:!0}),void buddydrive.App.router.navigate("user/"+b(a.currentTarget).data("user-id"),{trigger:!0}))},showSharingBox:function(a){return b("#buddydrive-browser").hasClass("bulk-select")?a:(a.preventDefault(),void this.$el.find(".buddydrive-share-dialog").removeClass("buddydrive-hide"))},hideSharingBox:function(a){a.preventDefault(),this.$el.find(".buddydrive-share-dialog").addClass("buddydrive-hide")},selectEmbed:function(a){a.preventDefault(),a.target.select()}}),buddydrive.Views.BreadCrumb=buddydrive.View.extend({tagName:"li",template:buddydrive.template("buddydrive-nav-item"),events:{"click .buddydrive-crumb":"allQuery"},initialize:function(){!0===this.model.get("current")&&(this.el.className="current")},allQuery:function(a){a.preventDefault();var c=b(a.currentTarget).data("crumb");"all"!==c&&c?(buddydrive.App.Query.set({buddydrive_parent:0,paged:1},{silent:!0}),buddydrive.App.router.navigate("#user/"+c.replace("user-",""),{trigger:!0})):buddydrive.App.router.navigate("#",{trigger:!0})}}),buddydrive.Views.manageBarItem=buddydrive.View.extend({tagName:"li",template:buddydrive.template("buddydrive-manage-toolbar"),events:{click:"doAction"},doAction:function(a){a.preventDefault(),this.model.get("active")?this.model.set("active",!1):this.model.set("active",!0)}}),buddydrive.Views.manageBar=buddydrive.View.extend({tagName:"ul",id:"buddydrive-manage-actions",initialize:function(){var a=buddydrive.App.Query.get("buddydrive_parent"),b="members"===buddydrive.Settings.buddydrive_scope;_.each(buddydrive.Settings.manage_toolbar,function(c){(!a&&!b||a&&"new_folder"!==c.id||"stats"===c.id)&&(this.collection.add(c),this.addItemBar(this.collection.get(c.id)))},this)},addItemBar:function(a){this.views.add(new buddydrive.Views.manageBarItem({model:a}))}}),buddydrive.Views.Toolbar=buddydrive.View.extend({tagName:"nav",className:"buddydrive-toolbar",initialize:function(){var a=[];this._views={},_.isUndefined(buddydrive.Uploader)||a.push(new buddydrive.Views.manageBar({collection:this.options.actions})),this.primary=new buddydrive.Views.LoopFilter({filters:buddydrive.Settings.loop_filters,current:buddydrive.App.Query.get("orderby")||"modified"}),this.secondary=new buddydrive.Views.SearchForm({model:buddydrive.App.Query}),this.views.set(_.union(a,[this.primary,this.secondary])),this.primary.model.on("change",this.orderQuery,this)},orderQuery:function(a){buddydrive.App.Query.set({orderby:a.get("selected"),paged:1})}}),buddydrive.Views.Input=buddydrive.View.extend({tagName:"input",initialize:function(){_.isObject(this.options)&&_.each(this.options,function(a,b){"value"===b?this.$el.val(a):this.$el.prop(b,a)},this)}}),buddydrive.Views.Label=buddydrive.Views.Input.extend({tagName:"label",render:function(){return this.$el.html(this.options.text),this}}),buddydrive.Views.Button=buddydrive.Views.Label.extend({tagName:"button"}),buddydrive.Views.LoadMore=buddydrive.Views.Button.extend({id:"buddydrive-load-more",events:{click:"loadMore"},loadMore:function(a){a.preventDefault(),this.model.set("paged",buddydrive.App.items.options.paged+1)}}),buddydrive.Views.SearchForm=buddydrive.Views.Input.extend({tagName:"input",className:"search",id:"buddydrive-search-input",attributes:{type:"search",placeholder:"Search"},events:{keyup:"maybeSearch",search:"search"},render:function(){return this.el.value=this.model.escape("search"),this},search:function(a){a.target.value?this.model.set("search",a.target.value):this.model.unset("search")},maybeSearch:function(a){return!0===/WebKit/.test(navigator.userAgent)?void a.preventDefault():void(13===a.keyCode&&this.search(a))}}),buddydrive.Views.PrivacyFilter=buddydrive.View.extend({tagName:"select",id:"buddydrive-privacy-filter",attributes:{name:"privacy","aria-label":buddydrive.Strings.privacyFilterLabel},events:{change:"change"},keys:[],initialize:function(){var a=this.options.current;this.model=new Backbone.Model,this.filters=this.options.filters||{},this.$el.html(_.chain(this.filters).map(function(c,d){return{el:a===d?b("<option></option>").val(d).html(c.text).prop("selected",!0)[0]:b("<option></option>").val(d).html(c.text)[0],priority:c.priority||5}},this).sortBy("priority").pluck("el").value())},change:function(){var a=this.filters[this.el.value];a&&this.model.set({selected:this.el.value})}}),buddydrive.Views.bulkEdit=buddydrive.View.extend({tagName:"div",id:"buddydrive-bulk-edit",events:{"click .bulk-action":"doBulkEdit"},initialize:function(){this.bulkActions=this.options.bulkActions||{},this.options.warnings.get("message")&&this.options.warnings.clear(),this.$el.html(_.chain(this.bulkActions).map(function(a){var c="button-primary button-large bulk-action";return"remove"!==a.id||buddydrive.App.Query.get("buddydrive_parent")||(c+=" buddydrive-hide"),b("<button></button>").html(a.text).prop("class",c).attr("data-action",a.id)[0]},this).value())},doBulkEdit:function(a){var c=[];a.preventDefault(),_.each(this.collection.models,function(a){!0===a.get("bulk_selected")&&c.push(a.get("id"))}),c.length&&this.collection.bulkEdit({data:{type:b(a.currentTarget).data("action"),items:c},error:_.bind(this.bulkError,this)})},bulkError:function(a){a.message&&this.options.warnings.set("message",a.message)}}),buddydrive.Views.userStats=buddydrive.View.extend({tagName:"div",id:"buddydrive-user-stats",template:buddydrive.template("buddydrive-stats"),initialize:function(){this.model=new buddydrive.Models.Stat,this.model.stat(),this.listenTo(this.model,"change:used",this.rerender)},rerender:function(){this.render()}}),buddydrive.Views.LoopFilter=buddydrive.Views.PrivacyFilter.extend({id:"buddydrive-filter",attributes:{name:"buddydrive_filter","aria-label":buddydrive.Strings.loopFilterLabel}}),buddydrive.Views.Item=buddydrive.View.extend({tagName:"li",className:"buddydrive-item",template:buddydrive.template("buddydrive-object"),attributes:{role:"checkbox"},initialize:function(){this.model.get("selected")&&(this.el.className+=" selected")},events:{click:"setObject","click .buddydrive-object-remove":"removeView"},setObject:function(a){a.preventDefault(),b(a.target).hasClass("buddydrive-object-remove")||(!0===this.model.get("selected")?this.model.set("selected",!1):this.model.set("selected",!0))},removeView:function(a){a.preventDefault(),this.model.set("selected",!1),this.views.view.remove()}}),buddydrive.Views.ObjectSelection=buddydrive.View.extend({tagName:"ul",id:"buddydrive-object-selection",initialize:function(){this.collection.on("add",this.addItemView,this),this.collection.on("reset",this.cleanView,this),this.listenTo(this.collection,"change:selected",this.updateSelection)},addItemView:function(a){var c=this.views.parent.model.get("type")||"";this.views.add(new buddydrive.Views.Item({model:a})),"group"===a.get("buddydrive_type")&&a.get("selected")&&"folder"===c&&!b("#buddydrive-lookfor").hasClass("buddydrive-hide")&&b("#buddydrive-lookfor").addClass("buddydrive-hide")},cleanView:function(){_.each(this.views._views[""],function(a){a.remove()})},updateSelection:function(a){var c=this.views.parent.model.get("type")||"";!1===a.get("selected")&&this.collection.remove(a),"group"===a.get("buddydrive_type")&&"folder"===c&&b("#buddydrive-lookfor").hasClass("buddydrive-hide")&&b("#buddydrive-lookfor").removeClass("buddydrive-hide")}}),buddydrive.Views.AutoComplete=buddydrive.Views.ObjectSelection.extend({tagName:"ul",id:"buddydrive-autocomplete",events:{keyup:"autoComplete"},initialize:function(){var a=new buddydrive.Views.Input({type:"text",id:"buddydrive-lookfor",placeholder:this.options.placeholder||""}).render();this.$el.prepend(b("<li></li>").html(a.$el)),this.collection.on("add",this.maybeAddItemView,this),this.collection.on("reset",this.cleanView,this),this.listenTo(this.collection,"change:selected",this.updateSelection)},maybeAddItemView:function(a){this.options.selection.get(a.get("id"))||this.addItemView(a)},autoComplete:function(){var a=b("#buddydrive-lookfor").val();this.collection.reset(),2>a.length||this.collection.fetch({data:_.extend(_.pick(buddydrive.Settings,"buddydrive_scope"),{buddydrive_type:this.options.buddydrive_type,user_id:this.options.user_id,search:a}),success:_.bind(this.itemFetched,this),error:_.bind(this.itemFetched,this)})},itemFetched:function(a){a.length||this.cleanView()},updateSelection:function(a){var c=this.options.allow_multiple||!1;!0===this.options.is_folder&&"groups"===this.options.buddydrive_type&&(c=!1),!0===a.get("selected")?(this.options.selection.add(a),b("#buddydrive-lookfor").val(""),this.cleanView(),c||this.$el.addClass("buddydrive-hide")):c||this.$el.removeClass("buddydrive-hide")}}),buddydrive.Views.EditForm=buddydrive.View.extend({tagName:"section",className:"buddydrive-item",initialize:function(){this.warnings=new Backbone.Model,this.listenTo(this.warnings,"change:message",this.displayErrors),this.views.add(new buddydrive.View({tagName:"header",id:"buddydrive-item-header"})),this.views.add(new buddydrive.View({tagName:"article",id:"buddydrive-item-content"})),this.views.add(new buddydrive.View({tagName:"div",id:"buddydrive-status"})),_.isUndefined(this.model)?this.options.item_id&&(this.collection.fetch({data:_.extend(_.pick(buddydrive.Settings,"buddydrive_scope"),{id:this.options.item_id,is_edit:!0}),success:_.bind(this.itemFetched,this),error:_.bind(this.itemError,this)}),this.collection.on("add",this.displayDetails,this)):this.displayDetails(this.model)},itemFetched:function(a,c){a.length?(b("header#buddydrive-item-header").removeClass("buddydrive-hide"),b("article#buddydrive-item-content").removeClass("buddydrive-hide")):(b("header#buddydrive-item-header").addClass("buddydrive-hide"),b("article#buddydrive-item-content").addClass("buddydrive-hide"),_.isUndefined(c.metas.no_items_found)||this.warnings.set("message",c.metas.no_items_found))},itemError:function(a,c){c.message&&(b("header#buddydrive-item-header").addClass("buddydrive-hide"),b("article#buddydrive-item-content").addClass("buddydrive-hide"),this.warnings.set("message",c.message))},displayErrors:function(a){this.cleanViews("#buddydrive-status"),this.views.add("#buddydrive-status",new buddydrive.Views.Feedback({type:a.get("type")||"error",value:a.get("message")}))},displayDetails:function(a){this.views.add("#buddydrive-item-header",new buddydrive.Views.editHeader({model:a})),this.views.add("#buddydrive-item-content",new buddydrive.Views.Edit({model:a,warnings:this.warnings}))}}),buddydrive.Views.editHeader=buddydrive.View.extend({tagName:"div",template:buddydrive.template("buddydrive-edit-header")}),buddydrive.Views.Edit=buddydrive.View.extend({tagName:"form",template:buddydrive.template("buddydrive-edit-details"),className:"buddydrive-item-details",events:{reset:"resetItem",submit:"updateItem","click #buddydrive-remove-parent":"removeParentFolder"},initialize:function(){this.resetModel=this.model.clone(),this.bpobjects=new buddydrive.Collections.bpObjects,this.privacyFilters=buddydrive.Settings.privacy_filters,"folder"===this.model.get("type")&&(this.privacyFilters=_.omit(this.privacyFilters,"folder")),this.model.get("post_parent")||this.privacyDetails()},privacyDetails:function(){var a=this.model.get("privacy"),b=new buddydrive.Views.PrivacyFilter({filters:this.privacyFilters,current:a});this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.Label({"for":"buddydrive-privacy-filter",text:buddydrive.Strings.privacyFilterLabel})),this.views.add("#buddydrive-privacy-edit",b),"password"===a?this.passwordFrame():("groups"===a||"folder"===a||"members"===a)&&this.objectFrame(a),b.model.on("change",this.updatePrivacyOptions,this)},passwordFrame:function(){this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.Label({"for":"buddydrive-edit-password",text:buddydrive.Strings.passwordInputLabel})),this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.Input({type:"text",id:"buddydrive-edit-password",name:"password",value:this.model.get("password")}))},objectFrame:function(a){var b=!1,c="",d={};this.bpobjects.reset(),this.selection=this.bpobjects.clone(),_.isUndefined(this.privacyFilters[a])||(b=this.privacyFilters[a].allow_multiple,c=this.privacyFilters[a].autocomplete_placeholder),this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.AutoComplete({collection:this.bpobjects,user_id:this.model.get("user_id"),buddydrive_type:a,allow_multiple:b,placeholder:c,selection:this.selection,is_folder:"folder"===this.model.get("type")})),this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.ObjectSelection({collection:this.selection})),"groups"===a&&this.model.get("group")&&(d={user_id:this.model.get("user_id"),include:this.model.get("group"),buddydrive_type:"groups",existing:!0}),"members"===a&&this.model.get("members")&&(d={include:this.model.get("members"),buddydrive_type:"members",existing:!0}),!0===d.existing&&this.selection.fetch({data:_.extend(_.pick(buddydrive.Settings,"buddydrive_scope"),d)})},resetItem:function(a){a.preventDefault(),!0!==this.model.get("saving")&&Backbone.history.history.back()},updateItem:function(a){if(a.preventDefault(),!0!==this.model.get("saving")){var b=_.pick(this.model.attributes,["id","user_id","title","content","privacy"]),c={},d=[];if(_.each(this.$el.serializeArray(),function(a){a.name=a.name.replace("[]",""),-1!==_.indexOf(["title","content","privacy","buddydrive_object","password"],a.name)?"buddydrive_object"===a.name?_.isArray(b[b.privacy])?b[b.privacy].push(a.value):b[b.privacy]=[a.value]:b[a.name]=a.value:-1===_.indexOf(["id","user_id"],a.name)&&(_.isUndefined(c[a.name])?c[a.name]=a.value:(_.isArray(c[a.name])||(c[a.name]=[c[a.name]]),c[a.name].push(a.value)))}),b.title||d.push("title"),-1===_.indexOf(["folder","groups","members","password"],b.privacy)||!_.isUndefined(b[b.privacy])&&b[b.privacy].length||d.push(b.privacy),0!==d.length)return void this.options.warnings.set("message",buddydrive.Strings.editErrors[_.first(d)]);this.options.warnings.set({type:"info",message:buddydrive.Strings.saveEdits}),this.model.get("post_parent")&&"folder"!==b.privacy&&(b.parent_folder_id=0,this.model.set("post_parent",0,{silent:!0})),"folder"===b.privacy&&_.isArray(b.folder)&&this.model.set("post_parent",_.first(b.folder),{silent:!0}),this.model.set("saving",!0),this.model.update(_.extend(b,c),{success:_.bind(this.itemUpdated,this),error:_.bind(this.itemUpdateError,this)})}},itemUpdated:function(){var a="#";this.model.set("saving",!1),this.model.get("post_parent")&&(a="#view/"+this.model.get("post_parent")),buddydrive.App.Query.set({orderby:"modified",search:""},{silent:!0}),buddydrive.App.router.navigate(a,{trigger:!0})},itemUpdateError:function(a){this.model.set("saving",!1),a.message&&this.options.warnings.set({type:"error",message:a.message})},removeParentFolder:function(a){a.preventDefault(),b(a.currentTarget).closest("#buddydrive-item-folder").remove(),this.privacyDetails()},updatePrivacyOptions:function(a){var b=a.get("selected"),c=!1;_.each(this.views._views["#buddydrive-privacy-edit"],function(a,b){_.isUndefined(a.options.filters)||(c=b+1),_.isNumber(c)&&b>=c&&a.remove()}),"password"===b?this.passwordFrame():("groups"===b||"folder"===b||"members"===b)&&this.objectFrame(b)}}),"undefined"!=typeof BP_Uploader&&(buddydrive.Views.UploadTool=buddydrive.View.extend({className:"bp-uploader-window",template:buddydrive.template("upload-window"),defaults:_.pick(BP_Uploader.settings.defaults,["container","drop_element","browse_button"]),initialize:function(){this.model=new Backbone.Model(this.defaults),this.on("ready",this.initUploader)},initUploader:function(){this.uploader=new buddydrive.Uploader.uploader,b(this.uploader).on("bp-uploader-warning",_.bind(this.setWarning,this)),b(this.uploader).on("bp-uploader-new-upload",_.bind(this.resetWarning,this)),b(this.uploader).on("bp-uploader-upload-complete",_.bind(this.resetObject,this))},setWarning:function(a,b){_.isUndefined(b)||this.options.warnings.set("message",b)},resetWarning:function(a,b){_.isUndefined(buddydrive.App.Query.get("user_id"))||"admin"!==buddydrive.Settings.buddydrive_scope||(b.settings.multipart_params.bp_params.item_id=buddydrive.App.Query.get("user_id")),_.isUndefined(buddydrive.App.Query.get("buddydrive_parent"))||(b.settings.multipart_params.bp_params.parent_folder_id=buddydrive.App.Query.get("buddydrive_parent"),"admin"===buddydrive.Settings.buddydrive_scope&&_.isUndefined(buddydrive.App.Query.get("user_id"))&&!_.isUndefined(buddydrive.App.items.options.post_parent_owner)&&(b.settings.multipart_params.bp_params.item_id=buddydrive.App.items.options.post_parent_owner)),"friends"===buddydrive.Settings.buddydrive_scope&&(b.settings.multipart_params.bp_params.privacy=buddydrive.Settings.buddydrive_scope),this.options.warnings.clear()},resetObject:function(a,c){_.extend(c.settings.multipart_params.bp_params,buddydrive.App.UploadParams),b("#buddydrive-uploader").addClass("buddydrive-hide"),this.options.actions.get("new_file").set("active",!1,{silent:!0})}}),buddydrive.Views.newFolder=buddydrive.View.extend({tagName:"div",id:"buddydrive-new-folder",events:{"click #create-folder":"createFolder"},initialize:function(){this._views={},this.options.warnings.get("message")&&this.options.warnings.clear(),this.views.set([new buddydrive.Views.Input({type:"text",id:"buddydrive-folder-title",name:"title",placeholder:buddydrive.Strings.new_folder_name}),new buddydrive.Views.Button({id:"create-folder","class":"button-primary button-large",text:buddydrive.Strings.new_folder_button})])},createFolder:function(a){a.preventDefault();var c=b("#buddydrive-folder-title").val(),d={};c&&(d={title:c,user_id:buddydrive.App.Query.get("user_id")},"friends"===buddydrive.Settings.buddydrive_scope&&(d.privacy=buddydrive.Settings.buddydrive_scope),buddydrive.App.items.addFolder({data:d,error:_.bind(this.folderError,this)}),this.model.set("active",!1))},folderError:function(a){a.message&&this.options.warnings.set("message",a.message)}}))}(buddydrive,jQuery);
;/*! BuddyDrive - v2.0.0-beta1 - 2016-05-19 9:39:15 PM UTC - https://github.com/imath/buddydrive/ */
window.buddydrive=window.buddydrive||{},function(a,b){buddydrive.App={start:function(){this.views=new Backbone.Collection,this.items=new buddydrive.Collections.Items,this.router=new buddydrive.App.Router,this.Query=new buddydrive.Models.Query(_.pick(buddydrive.Settings,"buddydrive_scope")),1e3>b("#buddydrive-main").width()&&b("#buddydrive-main").addClass("mini"),Backbone.history.start()},listFiles:function(){this.cleanScreen();var a=new buddydrive.Views.Main({collection:this.items});this.views.add({id:"files",view:a}),a.inject("#buddydrive-main")},editFile:function(a){this.cleanScreen();var b=new buddydrive.Views.EditForm({model:this.items.get(a),item_id:a,collection:this.items});this.views.add({id:"edit",view:b}),b.inject("#buddydrive-main")},cleanScreen:function(){_.isUndefined(this.views.models)||(_.each(this.views.models,function(a){a.get("view").remove()},this),this.views.reset())}},buddydrive.App.Router=Backbone.Router.extend({routes:{"edit/:id":"editItem","view/:id":"viewItem","user/:id":"userFilter","":"listView"},editItem:function(a){a&&buddydrive.App.editFile(a)},viewItem:function(a){a&&(buddydrive.App.Query.set({buddydrive_parent:a,paged:1},{silent:!0}),buddydrive.App.listFiles())},userFilter:function(a){a&&(buddydrive.App.Query.set({user_id:a,paged:1},{silent:!0}),buddydrive.App.listFiles())},listView:function(){var a=_.omit(buddydrive.App.Query.attributes,["buddydrive_parent","user_id"]);buddydrive.App.Query.clear({silent:!0}),buddydrive.App.Query.set(_.extend(a,{paged:1}),{silent:!0}),buddydrive.App.listFiles()}}),buddydrive.App.start()}(buddydrive,jQuery);